TAG=$(git rev-parse HEAD)

echo 'ðŸš€ Deploying traefik...'
helm install traefik oci://ghcr.io/traefik/helm/traefik --values ./deployment/traefik/values.yaml

echo 'ðŸš€ Deploying kafka...'
helm install kafka oci://registry-1.docker.io/bitnamicharts/kafka --values ./deployment/kafka/values.yaml

echo 'ðŸ“¦ Building notification...'
docker build -t mrcaidev/telemedicine-notification:$TAG notification

echo 'ðŸš€ Deploying notification...'
minikube image load mrcaidev/telemedicine-notification:$TAG
helm install notification ./deployment/notification --set image=mrcaidev/telemedicine-notification:$TAG

echo 'ðŸš€ Deploying user-postgres...'
kubectl create configmap user-postgres-initdb --from-file=./user/init/postgres
helm install user-postgres oci://registry-1.docker.io/bitnamicharts/postgresql --values ./deployment/user-postgres/values.yaml

echo 'ðŸ“¦ Building user...'
docker build -t mrcaidev/telemedicine-user:$TAG user

echo 'ðŸš€ Deploying user...'
minikube image load mrcaidev/telemedicine-user:$TAG
helm install user ./deployment/user --set image=mrcaidev/telemedicine-user:$TAG

echo 'ðŸš€ Deploying appointment-postgres...'
kubectl create configmap appointment-postgres-initdb --from-file=./appointment/init/postgres
helm install appointment-postgres oci://registry-1.docker.io/bitnamicharts/postgresql --values ./deployment/appointment-postgres/values.yaml

echo 'ðŸ“¦ Building appointment...'
docker build -t mrcaidev/telemedicine-appointment:$TAG appointment

echo 'ðŸš€ Deploying appointment...'
minikube image load mrcaidev/telemedicine-appointment:$TAG
helm install appointment ./deployment/appointment --set image=mrcaidev/telemedicine-appointment:$TAG

echo 'ðŸš€ Deploying web-dashboard...'
helm install web-dashboard ./deployment/web-dashboard
